<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CrashCoin Predictor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chart.js/3.9.1/chart.min.js"></script>
    <style>
        :root {
            --primary-color: #ff6b35;
            --secondary-color: #f7c59f;
            --dark-color: #1a1a2e;
            --light-color: #e6e6e6;
            --success-color: #06d6a0;
            --danger-color: #ef476f;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #0f0f1a;
            color: #fff;
            min-height: 100vh;
        }
        
        header {
            background-color: var(--dark-color);
            color: white;
            padding: 1rem 0;
            text-align: center;
            border-bottom: 3px solid var(--primary-color);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        
        .logo {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .stats {
            display: flex;
            gap: 1.5rem;
        }
        
        .stats-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .stats-value {
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .stats-label {
            font-size: 0.8rem;
            color: var(--secondary-color);
        }
        
        main {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        
        .game-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
        }
        
        @media (max-width: 768px) {
            .game-container {
                grid-template-columns: 1fr;
            }
        }
        
        .chart-container {
            background-color: rgba(26, 26, 46, 0.8);
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            align-items: center;
        }
        
        .chart-title {
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .current-price {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--secondary-color);
        }
        
        .price-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .price-change {
            font-size: 1rem;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
        }
        
        .positive {
            background-color: rgba(6, 214, 160, 0.2);
            color: var(--success-color);
        }
        
        .negative {
            background-color: rgba(239, 71, 111, 0.2);
            color: var(--danger-color);
        }
        
        canvas {
            width: 100%;
            height: 400px;
        }
        
        .control-panel {
            background-color: rgba(26, 26, 46, 0.8);
            border-radius: 10px;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .panel-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .prediction-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        label {
            font-size: 1rem;
            color: var(--secondary-color);
        }
        
        input, select {
            padding: 0.8rem;
            border-radius: 5px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background-color: rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 1rem;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        button {
            padding: 1rem;
            border-radius: 5px;
            border: none;
            background-color: var(--primary-color);
            color: white;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #e85a2a;
        }
        
        button:disabled {
            background-color: #666;
            cursor: not-allowed;
        }
        
        .status {
            padding: 1rem;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
        }
        
        .status.active {
            background-color: rgba(6, 214, 160, 0.2);
            color: var(--success-color);
        }
        
        .status.waiting {
            background-color: rgba(255, 209, 102, 0.2);
            color: #ffd166;
        }
        
        .status.crashed {
            background-color: rgba(239, 71, 111, 0.2);
            color: var(--danger-color);
        }
        
        .status-text {
            margin-bottom: 0.5rem;
        }
        
        .countdown {
            font-size: 1.5rem;
        }
        
        .leaderboard {
            margin-top: 2rem;
            background-color: rgba(26, 26, 46, 0.8);
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .leaderboard-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }
        
        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .leaderboard-table th, .leaderboard-table td {
            padding: 0.8rem;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .leaderboard-table th {
            color: var(--secondary-color);
            font-weight: normal;
        }
        
        .winner {
            background-color: rgba(6, 214, 160, 0.1);
        }
        
        .round-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .jackpot {
            font-size: 1.2rem;
        }
        
        .jackpot-value {
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .round-count {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 100;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: var(--dark-color);
            border-radius: 10px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        .modal-title {
            font-size: 1.8rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
        }
        
        .modal-text {
            margin-bottom: 1.5rem;
            font-size: 1.1rem;
            line-height: 1.5;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
        }
        
        .modal-btn {
            padding: 0.8rem 1.5rem;
        }
        
        .btn-secondary {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .btn-secondary:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .timer-circle {
            width: 120px;
            height: 120px;
            margin: 0 auto 1rem;
            position: relative;
        }
        
        .timer-bg {
            fill: none;
            stroke: rgba(255, 255, 255, 0.1);
            stroke-width: 10;
        }
        
        .timer-progress {
            fill: none;
            stroke: var(--primary-color);
            stroke-width: 10;
            stroke-linecap: round;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
            transition: stroke-dashoffset 1s linear;
        }
        
        .timer-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.8rem;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">CrashCoin Predictor</div>
            <div class="stats">
                <div class="stats-item">
                    <div class="stats-value" id="totalPlayers">0</div>
                    <div class="stats-label">PLAYERS</div>
                </div>
                <div class="stats-item">
                    <div class="stats-value" id="totalJackpot">250</div>
                    <div class="stats-label">SOL JACKPOT</div>
                </div>
                <div class="stats-item">
                    <div class="stats-value" id="totalGames">0</div>
                    <div class="stats-label">GAMES PLAYED</div>
                </div>
            </div>
        </div>
    </header>
    
    <main>
        <div class="round-info">
            <div class="jackpot">Current Jackpot: <span class="jackpot-value">250 SOL</span></div>
            <div class="round-count" id="roundCount">Round #1</div>
        </div>
        
        <div class="game-container">
            <div class="chart-container">
                <div class="chart-header">
                    <div class="chart-title">BTC Crash Simulator</div>
                    <div class="price-container">
                        <div class="current-price" id="currentPrice">$78,726.62</div>
                        <div class="price-change negative" id="priceChange">-0.00%</div>
                    </div>
                </div>
                <canvas id="priceChart"></canvas>
            </div>
            
            <div class="control-panel">
                <div>
                    <div class="panel-title">Make Your Prediction</div>
                    <div class="prediction-form">
                        <div class="form-group">
                            <label for="predictedPrice">Predicted Crash Price ($)</label>
                            <input type="number" id="predictedPrice" placeholder="Enter your price prediction" min="0" max="78726.62" step="0.01">
                        </div>
                        <div class="form-group">
                            <label for="walletAddress">Your SOL Wallet</label>
                            <input type="text" id="walletAddress" placeholder="Enter your SOL wallet address">
                        </div>
                        <button id="placeBetBtn">Lock In Prediction</button>
                    </div>
                </div>
                
                <div class="status" id="gameStatus">
                    <div class="status-text">Waiting for next round...</div>
                    <div class="countdown" id="countdown">00:30</div>
                    <svg class="timer-circle" viewBox="0 0 120 120">
                        <circle class="timer-bg" cx="60" cy="60" r="50"></circle>
                        <circle class="timer-progress" cx="60" cy="60" r="50" id="timerCircle"></circle>
                    </svg>
                </div>
            </div>
        </div>
        
        <div class="leaderboard">
            <div class="leaderboard-title">Player Predictions</div>
            <table class="leaderboard-table">
                <thead>
                    <tr>
                        <th>Player</th>
                        <th>Prediction</th>
                        <th>Difference</th>
                        <th>Result</th>
                    </tr>
                </thead>
                <tbody id="leaderboardBody">
                    <!-- Players will be added here dynamically -->
                </tbody>
            </table>
        </div>
    </main>
    
    <div class="modal" id="resultModal">
        <div class="modal-content">
            <div class="modal-title">Round Results</div>
            <div class="modal-text" id="modalText">
                The Bitcoin price crashed to $65,432.10!<br>
                <strong>Player123</strong> had the closest prediction and won <strong>250 SOL</strong>!
            </div>
            <div class="modal-buttons">
                <button class="modal-btn" id="nextRoundBtn">Next Round</button>
            </div>
        </div>
    </div>
    
    <script>
        // Chart initialization
        let chart;
        let priceHistory = [];
        let currentPrice = 78726.62;
        let gameActive = false;
        let gameInterval;
        let countdownInterval;
        let roundNumber = 1;
        let totalGames = 0;
        let totalPlayers = 0;
        let jackpotAmount = 250;
        let timeLeft = 30;
        let crashPoint = 0;
        let gamePhase = "waiting"; // waiting, active, crashed
        let predictions = [];
        let wallets = {};

        // DOM Elements
        const priceElement = document.getElementById('currentPrice');
        const priceChangeElement = document.getElementById('priceChange');
        const gameStatusElement = document.getElementById('gameStatus');
        const countdownElement = document.getElementById('countdown');
        const timerCircle = document.getElementById('timerCircle');
        const placeBetBtn = document.getElementById('placeBetBtn');
        const predictedPriceInput = document.getElementById('predictedPrice');
        const walletAddressInput = document.getElementById('walletAddress');
        const leaderboardBody = document.getElementById('leaderboardBody');
        const resultModal = document.getElementById('resultModal');
        const modalText = document.getElementById('modalText');
        const nextRoundBtn = document.getElementById('nextRoundBtn');
        const roundCountElement = document.getElementById('roundCount');
        const totalPlayersElement = document.getElementById('totalPlayers');
        const totalJackpotElement = document.getElementById('totalJackpot');
        const totalGamesElement = document.getElementById('totalGames');

        // Initialize chart
        function initializeChart() {
            const ctx = document.getElementById('priceChart').getContext('2d');
            
            // Generate initial price history (last 60 data points)
            priceHistory = Array(60).fill().map((_, i) => {
                // Create a slightly increasing trend with small variations
                return {
                    time: new Date(Date.now() - (60 - i) * 1000).toLocaleTimeString('en-US', { 
                        hour: '2-digit', 
                        minute: '2-digit', 
                        second: '2-digit',
                        hour12: false
                    }),
                    price: currentPrice - (Math.random() * 200 - 100)
                };
            });
            
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: priceHistory.map(data => data.time),
                    datasets: [{
                        label: 'BTC Price (USD)',
                        data: priceHistory.map(data => data.price),
                        borderColor: '#ff6b35',
                        backgroundColor: 'rgba(255, 107, 53, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.3,
                        pointRadius: 0,
                        pointHoverRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.05)'
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)',
                                maxRotation: 0,
                                autoSkip: true,
                                maxTicksLimit: 10
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.05)'
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)',
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    return '$' + context.raw.toLocaleString();
                                }
                            }
                        }
                    },
                    interaction: {
                        mode: 'nearest',
                        axis: 'x',
                        intersect: false
                    },
                    animation: {
                        duration: 0
                    }
                }
            });
        }

        // Update chart with new price data
        function updateChart(newPrice) {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit',
                hour12: false
            });
            
            priceHistory.push({
                time: timeString,
                price: newPrice
            });
            
            // Remove oldest data point if we have more than 60
            if (priceHistory.length > 60) {
                priceHistory.shift();
            }
            
            chart.data.labels = priceHistory.map(data => data.time);
            chart.data.datasets[0].data = priceHistory.map(data => data.price);
            
            chart.update();
        }

        // Format price display
        function formatPrice(price) {
            return '$' + price.toLocaleString(undefined, {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }

        // Calculate and display price change
        function updatePriceChange() {
            const previousPrice = priceHistory[priceHistory.length - 2]?.price || currentPrice;
            const percentChange = ((currentPrice - previousPrice) / previousPrice) * 100;
            
            priceElement.textContent = formatPrice(currentPrice);
            priceChangeElement.textContent = percentChange.toFixed(2) + '%';
            
            if (percentChange >= 0) {
                priceChangeElement.className = 'price-change positive';
            } else {
                priceChangeElement.className = 'price-change negative';
            }
        }

        // Timer functions
        function startCountdown(seconds) {
            timeLeft = seconds;
            updateCountdown();
            
            // Set up the timer circle
            const circumference = 2 * Math.PI * 50;
            timerCircle.style.strokeDasharray = circumference;
            timerCircle.style.strokeDashoffset = 0;
            
            countdownInterval = setInterval(() => {
                timeLeft--;
                updateCountdown();
                
                // Update timer circle
                const offset = circumference * (1 - timeLeft / seconds);
                timerCircle.style.strokeDashoffset = offset;
                
                if (timeLeft <= 0) {
                    clearInterval(countdownInterval);
                    startGame();
                }
            }, 1000);
        }

        function updateCountdown() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            countdownElement.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        // Game state functions
        function waitForNextRound() {
            gamePhase = "waiting";
            gameStatusElement.className = "status waiting";
            gameStatusElement.querySelector(".status-text").textContent = "Waiting for next round...";
            placeBetBtn.disabled = false;
            predictedPriceInput.disabled = false;
            walletAddressInput.disabled = false;
            
            startCountdown(30);
        }

        function startGame() {
            gamePhase = "active";
            gameActive = true;
            
            // Disable inputs during active game
            placeBetBtn.disabled = true;
            predictedPriceInput.disabled = true;
            walletAddressInput.disabled = true;
            
            // Update status
            gameStatusElement.className = "status active";
            gameStatusElement.querySelector(".status-text").textContent = "Bitcoin is crashing!";
            
            // Determine crash point (between 40-75% of current price)
            const minCrash = currentPrice * 0.4;
            const maxCrash = currentPrice * 0.75;
            crashPoint = minCrash + Math.random() * (maxCrash - minCrash);
            
            // Start price update interval
            gameInterval = setInterval(updateGameState, 500);
        }

        function updateGameState() {
            // Calculate price decrease rate - faster as it gets closer to crash point
            const distanceToTarget = currentPrice - crashPoint;
            const decreaseRate = Math.max(distanceToTarget * 0.05, 50 + Math.random() * 100);
            
            // Update price
            currentPrice -= decreaseRate;
            
            // Update display
            updateChart(currentPrice);
            updatePriceChange();
            
            // Check if we've reached the crash point
            if (currentPrice <= crashPoint) {
                endGame();
            }
        }

        function endGame() {
            clearInterval(gameInterval);
            gameActive = false;
            gamePhase = "crashed";
            totalGames++;
            totalGamesElement.textContent = totalGames;
            
            // Update status
            gameStatusElement.className = "status crashed";
            gameStatusElement.querySelector(".status-text").textContent = "Bitcoin has crashed!";
            countdownElement.textContent = formatPrice(currentPrice);
            
            // Calculate results
            calculateResults();
            
            // Show modal after a short delay
            setTimeout(showResults, 2000);
        }

        // Prediction and results functions
        function placeBet() {
            const predictedPrice = parseFloat(predictedPriceInput.value);
            const walletAddress = walletAddressInput.value.trim();
            
            if (isNaN(predictedPrice) || predictedPrice <= 0 || predictedPrice > currentPrice) {
                alert("Please enter a valid price prediction (greater than 0 and less than current price)");
                return;
            }
            
            if (!walletAddress) {
                alert("Please enter your SOL wallet address");
                return;
            }
            
            // Store wallet address for this prediction
            const playerId = `Player${predictions.length + 1}`;
            wallets[playerId] = walletAddress;
            
            // Add prediction to list
            predictions.push({
                id: playerId,
                prediction: predictedPrice,
                difference: 0, // Will be calculated when the game ends
                result: ""
            });
            
            // Update player count
            totalPlayers++;
            totalPlayersElement.textContent = totalPlayers;
            
            // Update leaderboard
            updateLeaderboard();
            
            // Clear form
            predictedPriceInput.value = "";
            walletAddressInput.value = "";
            
            // Disable button for this player (in a real app, you'd check if they've already bet)
            placeBetBtn.disabled = true;
            
            alert("Your prediction has been locked in!");
        }

        function updateLeaderboard() {
            // Clear current leaderboard
            leaderboardBody.innerHTML = "";
            
            // Add each prediction
            predictions.forEach(player => {
                const row = document.createElement("tr");
                if (player.result === "Winner") {
                    row.className = "winner";
                }
                
                // Create masked wallet address display
                const walletAddress = wallets[player.id] || "";
                const maskedWallet = walletAddress.length > 8 
                    ? walletAddress.substring(0, 4) + "..." + walletAddress.substring(walletAddress.length - 4) 
                    : walletAddress;
                
                row.innerHTML = `
                    <td>${player.id} (${maskedWallet})</td>
                    <td>${formatPrice(player.prediction)}</td>
                    <td>${player.difference ? formatPrice(Math.abs(player.difference)) : "-"}</td>
                    <td>${player.result}</td>
                `;
                
                leaderboardBody.appendChild(row);
            });
        }

        function calculateResults() {
            // Calculate difference for each prediction
            predictions.forEach(player => {
                player.difference = player.prediction - currentPrice;
                player.result = "Lost";
            });
            
            // Sort by absolute difference
            predictions.sort((a, b) => Math.abs(a.difference) - Math.abs(b.difference));
            
            // Mark winner
            if (predictions.length > 0) {
                predictions[0].result = "Winner";
            }
            
            // Update leaderboard
            updateLeaderboard();
        }

        function showResults() {
            // Update modal text
            if (predictions.length > 0) {
                const winner = predictions[0];
                modalText.innerHTML = `
                    The Bitcoin price crashed to ${formatPrice(currentPrice)}!<br>
                    <strong>${winner.id}</strong> had the closest prediction (${formatPrice(winner.prediction)}) 
                    and won <strong>${jackpotAmount} SOL</strong>!
                `;
            } else {
                modalText.innerHTML = `
                    The Bitcoin price crashed to ${formatPrice(currentPrice)}!<br>
                    No players participated in this round.
                `;
            }
            
            // Show modal
            resultModal.style.display = "flex";
        }

        function startNextRound() {
            // Hide modal
            resultModal.style.display = "none";
            
            // Increment round number
            roundNumber++;
            roundCountElement.textContent = `Round #${roundNumber}`;
            
            // Reset game state
            predictions = [];
            
            // Reset price to a new starting point (with slight variation)
            currentPrice = 78726.62 + (Math.random() * 2000 - 1000);
            updatePriceChange();
            
            // Start new round
            waitForNextRound();
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            initializeChart();
            waitForNextRound();
            
            // Set up button event listeners
            placeBetBtn.addEventListener('click', placeBet);
            nextRoundBtn.addEventListener('click', startNextRound);
            
            // Update stats
            totalPlayersElement.textContent = totalPlayers;
            totalJackpotElement.textContent = jackpotAmount;
            totalGamesElement.textContent = totalGames;
            roundCountElement.textContent = `Round #${roundNumber}`;
            
            // Update price display initially
            updatePriceChange();
            
            // Simulate small market fluctuations during waiting phase
            setInterval(() => {
                if (!gameActive) {
                    // Small random price changes
                    currentPrice += (Math.random() * 20 - 10);
                    updateChart(currentPrice);
                    updatePriceChange();
                }
            }, 1000);
        });
    </script>
</body>
</html>
